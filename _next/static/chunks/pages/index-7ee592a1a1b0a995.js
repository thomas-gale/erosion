(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{7314:function(t,a,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return e(6709)}])},6709:function(t,a,e){"use strict";e.r(a),e.d(a,{default:function(){return O}});var r=e(2322),i=e(3804),o=e(6995),s=e(1174),n=e(5436),c=e(9476),m=e(680),l=e(1353),h=function(t){var a=t.mapControls;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.c,{makeDefault:!0,position:[0,50,0],up:[0,1,0],zoom:1}),(0,r.jsx)(l.o,{panSpeed:1,rotateSpeed:1,zoomSpeed:1,minDistance:5,maxDistance:100,target:[16,0,16],maxPolarAngle:Math.PI/4,ref:a})]})},g=e(4719),u=e(7637),y=function(){return(0,r.jsx)(g.I,{alignment:"bottom-right",margin:[80,80],children:(0,r.jsx)(u.f,{axisColors:["red","green","blue"],labelColor:"black",hideNegativeAxes:!1,renderOrder:1})})},k=e(2784),_=e(8013),x=e(7328),M=e(6670),d=e(6838);function p(t){var a=(0,_.Z)({},t),e=(0,k.useRef)(),i=(0,d.L)("/digger_v1_static.glb"),o=i.nodes,s=i.materials;return(0,r.jsxs)("group",(0,M.Z)((0,x.Z)({ref:e},a),{dispose:null,children:[(0,r.jsx)("mesh",{geometry:o.chassis.geometry,material:o.chassis.material,position:[0,1.1,0],children:(0,r.jsx)("mesh",{geometry:o.bearing.geometry,material:o.bearing.material,position:[0,-.7,0]})}),(0,r.jsx)("mesh",{geometry:o.low_shovel.geometry,material:o.low_shovel.material,position:[0,.21,-2.13],children:(0,r.jsx)("mesh",{geometry:o.shovel_attachment.geometry,material:o.shovel_attachment.material,position:[0,.1,.76]})}),(0,r.jsxs)("mesh",{geometry:o.engine_base.geometry,material:s.yellow_metal,position:[0,.8,-.3],children:[(0,r.jsx)("mesh",{geometry:o.exhaust.geometry,material:o.exhaust.material,position:[.59,.78,1.44],rotation:[0,.72,0]}),(0,r.jsx)("mesh",{geometry:o.exhaust001.geometry,material:o.exhaust001.material,position:[.42,.78,1.44],rotation:[0,.72,0]})]}),(0,r.jsx)("mesh",{geometry:o.cabin.geometry,material:o.cabin.material,position:[-.53,1.77,-.06]}),(0,r.jsx)("mesh",{geometry:o.tracks.geometry,material:o.tracks.material,position:[-.81,.3,0],rotation:[0,0,-Math.PI/2]}),(0,r.jsx)("mesh",{geometry:o.static_track039.geometry,material:o.static_track039.material,position:[-.81,0,1.54],rotation:[3.12,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track040.geometry,material:o.static_track040.material,position:[-.81,0,1.31],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track041.geometry,material:o.static_track041.material,position:[-.81,0,1.08],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track042.geometry,material:o.static_track042.material,position:[-.81,0,.85],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track043.geometry,material:o.static_track043.material,position:[-.81,0,.62],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track044.geometry,material:o.static_track044.material,position:[-.81,0,.39],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track045.geometry,material:o.static_track045.material,position:[-.81,0,.16],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track046.geometry,material:o.static_track046.material,position:[-.81,0,-.07],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track047.geometry,material:o.static_track047.material,position:[-.81,0,-.31],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track048.geometry,material:o.static_track048.material,position:[-.81,0,-.54],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track049.geometry,material:o.static_track049.material,position:[-.81,0,-.77],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track050.geometry,material:o.static_track050.material,position:[-.81,0,-1],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track051.geometry,material:o.static_track051.material,position:[-.81,0,-1.23],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track052.geometry,material:o.static_track052.material,position:[-.81,0,-1.46],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track053.geometry,material:o.static_track053.material,position:[-.81,.02,-1.69],rotation:[-2.96,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track054.geometry,material:o.static_track054.material,position:[-.81,.12,-1.88],rotation:[-2.33,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track055.geometry,material:o.static_track055.material,position:[-.81,.31,-1.95],rotation:[-1.51,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track056.geometry,material:o.static_track056.material,position:[-.81,.5,-1.86],rotation:[-.69,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track057.geometry,material:o.static_track057.material,position:[-.81,.58,-1.66],rotation:[-.13,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track058.geometry,material:o.static_track058.material,position:[-.81,.6,-1.43],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track059.geometry,material:o.static_track059.material,position:[-.81,.6,-1.2],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track060.geometry,material:o.static_track060.material,position:[-.81,.6,-.97],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track061.geometry,material:o.static_track061.material,position:[-.81,.6,-.73],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track062.geometry,material:o.static_track062.material,position:[-.81,.6,-.5],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track063.geometry,material:o.static_track063.material,position:[-.81,.6,-.27],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track064.geometry,material:o.static_track064.material,position:[-.81,.6,-.04],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track065.geometry,material:o.static_track065.material,position:[-.81,.6,.19],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track066.geometry,material:o.static_track066.material,position:[-.81,.6,.42],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track067.geometry,material:o.static_track067.material,position:[-.81,.6,.65],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track068.geometry,material:o.static_track068.material,position:[-.81,.6,.88],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track069.geometry,material:o.static_track069.material,position:[-.81,.6,1.11],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track070.geometry,material:o.static_track070.material,position:[-.81,.6,1.34],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track071.geometry,material:o.static_track071.material,position:[-.81,.6,1.57],rotation:[.04,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track072.geometry,material:o.static_track072.material,position:[-.81,.54,1.79],rotation:[.44,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track073.geometry,material:o.static_track073.material,position:[-.81,.39,1.93],rotation:[1.2,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track074.geometry,material:o.static_track074.material,position:[-.81,.19,1.92],rotation:[2.04,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track075.geometry,material:o.static_track075.material,position:[-.81,.05,1.77],rotation:[2.78,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.tracks001.geometry,material:o.tracks001.material,position:[.82,.3,0],rotation:[0,0,-Math.PI/2]}),(0,r.jsx)("mesh",{geometry:o.static_track002.geometry,material:o.static_track002.material,position:[.82,0,1.54],rotation:[3.12,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track003.geometry,material:o.static_track003.material,position:[.82,0,1.31],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track004.geometry,material:o.static_track004.material,position:[.82,0,1.08],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track005.geometry,material:o.static_track005.material,position:[.82,0,.85],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track006.geometry,material:o.static_track006.material,position:[.82,0,.62],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track007.geometry,material:o.static_track007.material,position:[.82,0,.39],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track008.geometry,material:o.static_track008.material,position:[.82,0,.16],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track009.geometry,material:o.static_track009.material,position:[.82,0,-.07],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track010.geometry,material:o.static_track010.material,position:[.82,0,-.31],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track011.geometry,material:o.static_track011.material,position:[.82,0,-.54],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track012.geometry,material:o.static_track012.material,position:[.82,0,-.77],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track013.geometry,material:o.static_track013.material,position:[.82,0,-1],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track014.geometry,material:o.static_track014.material,position:[.82,0,-1.23],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track015.geometry,material:o.static_track015.material,position:[.82,0,-1.46],rotation:[Math.PI,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track016.geometry,material:o.static_track016.material,position:[.82,.02,-1.69],rotation:[-2.96,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track017.geometry,material:o.static_track017.material,position:[.82,.12,-1.88],rotation:[-2.33,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track018.geometry,material:o.static_track018.material,position:[.82,.31,-1.95],rotation:[-1.51,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track019.geometry,material:o.static_track019.material,position:[.82,.5,-1.86],rotation:[-.69,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track020.geometry,material:o.static_track020.material,position:[.82,.58,-1.66],rotation:[-.13,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track021.geometry,material:o.static_track021.material,position:[.82,.6,-1.43],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track022.geometry,material:o.static_track022.material,position:[.82,.6,-1.2],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track023.geometry,material:o.static_track023.material,position:[.82,.6,-.97],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track024.geometry,material:o.static_track024.material,position:[.82,.6,-.73],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track025.geometry,material:o.static_track025.material,position:[.82,.6,-.5],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track026.geometry,material:o.static_track026.material,position:[.82,.6,-.27],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track027.geometry,material:o.static_track027.material,position:[.82,.6,-.04],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track028.geometry,material:o.static_track028.material,position:[.82,.6,.19],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track029.geometry,material:o.static_track029.material,position:[.82,.6,.42],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track030.geometry,material:o.static_track030.material,position:[.82,.6,.65],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track031.geometry,material:o.static_track031.material,position:[.82,.6,.88],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track032.geometry,material:o.static_track032.material,position:[.82,.6,1.11],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track033.geometry,material:o.static_track033.material,position:[.82,.6,1.34],rotation:[0,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track034.geometry,material:o.static_track034.material,position:[.82,.6,1.57],rotation:[.04,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track035.geometry,material:o.static_track035.material,position:[.82,.54,1.79],rotation:[.44,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track036.geometry,material:o.static_track036.material,position:[.82,.39,1.93],rotation:[1.2,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track037.geometry,material:o.static_track037.material,position:[.82,.19,1.92],rotation:[2.04,0,Math.PI]}),(0,r.jsx)("mesh",{geometry:o.static_track038.geometry,material:o.static_track038.material,position:[.82,.05,1.77],rotation:[2.78,0,-Math.PI]}),(0,r.jsx)("mesh",{geometry:o.drill_profile.geometry,material:s.drill,position:[0,1.09,-3.5]}),(0,r.jsx)("mesh",{geometry:o.drill_bearing.geometry,material:o.drill_bearing.material,position:[0,1.1,-1.6]}),(0,r.jsx)("mesh",{geometry:o.drill_pivot.geometry,material:o.drill_pivot.material,position:[0,1.1,-1.6],rotation:[0,0,-Math.PI/2]})]}))}d.L.preload("/digger_v1_static.glb");var P=e(8788),v=e(5680),j=e(2228),f=e(7294),I=e(7608),z=e(1096),b=e.n(z);function w(){var t=(0,j.Z)(["\n    attribute vec3 metadata;\n\n    out vec3 norm;\n    out float height;\n    out vec2 pos2;\n    out vec3 md;\n\n    void main() {\n      norm = normal;\n      height = position.y;\n      pos2 = position.xz;\n      md = metadata;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  "]);return w=function(){return t},t}function S(){var t=(0,j.Z)(["\n    #define grass vec3(.2, .7, .1)\n    #define soil vec3(.5, .5, .3)\n    #define rock vec3(.3, .3, .3)\n    // TODO - pass from uniform\n    #define chunkSize 32.\n\n    uniform vec3 sunPosition;\n\n    in vec3 norm;\n    in float height;\n    in vec2 pos2;\n    in vec3 md;\n\n    void main() {\n      float shadow = 1. - (.75 * dot(normalize(norm), normalize(sunPosition)));\n\n      // TODO - override grassy if the metadata indicates it's a freshly modified region (to just soil)\n      float grassy = smoothstep(.9, 1., normalize(norm).y);\n      vec3 soilGrass = mix(soil, grass, grassy);\n      vec3 color = vec3(md.x * rock + md.y * soilGrass);\n\n      // Blend edges of chunk (make x/y positions near 0-1 ramp from transparent to opaque)\n      // float edge = smoothstep(0., 1., 0.5 * min(mod(pos2.x, chunkSize), mod(pos2.y, chunkSize)));\n\n      gl_FragColor.rgba = vec4(color, 1.) * shadow;\n\n    }\n  "]);return S=function(){return t},t}var E=(0,f.g)({sunPosition:new o.Vector3(0,-1,0)},b()(w()),b()(S()));(0,I.e)({ChunkMaterial:E});var N=function(t){var a=t.verts,e=t.vertsNum,i=t.vertsMetadata,o=t.vertsMetadataStride,s=t.vertsMetadataNum,n=t.cells,c=t.cellsNum,m=t.sunPosition,l=(0,k.useRef)();return(0,k.useEffect)((function(){l.current&&(l.current.index.needsUpdate=!0,l.current.attributes.position.needsUpdate=!0,l.current.attributes.metadata.needsUpdate=!0,l.current.computeVertexNormals())}),[a,n,i]),(0,k.useEffect)((function(){console.log("Re-rendering chunk geometry..."),console.log(null===n||void 0===n?void 0:n.length),console.log(c),console.log(null===i||void 0===i?void 0:i.length),console.log(s),console.log(null===a||void 0===a?void 0:a.length),console.log(e)}),[n,c,a,i,s,e]),(0,r.jsx)(r.Fragment,{children:(null===n||void 0===n?void 0:n.length)>0&&c>0&&(null===i||void 0===i?void 0:i.length)>0&&s>0&&(null===a||void 0===a?void 0:a.length)>0&&(0,r.jsxs)("mesh",{children:[(0,r.jsxs)("bufferGeometry",{attach:"geometry",ref:l,children:[(0,r.jsx)("bufferAttribute",{attach:"index",array:n,count:c,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-position",array:a,count:a.length/3,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-metadata",array:i,count:s/o,itemSize:o})]}),(0,r.jsx)("chunkMaterial",{attach:"material",sunPosition:m})]})})},T=function(t){var a,e,i,o=t.terrainWorker,s=t.xMin,n=t.zMin,c=t.xMax,m=t.zMax,l=t.padding,h=t.sunPosition,g=(0,k.useState)(),u=g[0],y=g[1],_=(0,k.useState)(0),x=_[0],M=_[1],d=(0,k.useState)(),p=d[0],j=d[1],f=(0,k.useState)(0),I=f[0],z=f[1],b=(0,k.useState)(0),w=b[0],S=b[1],E=(0,k.useState)(),T=E[0],C=E[1],Z=(0,k.useState)(0),L=Z[0],O=Z[1];return(0,k.useEffect)((function(){(0,P.Z)((function(){return(0,v.__generator)(this,(function(t){switch(t.label){case 0:return console.log("Triggering web worker mesh for ".concat(s,", ").concat(n,"...")),[4,o.postMessage({type:"loadMesh",payload:{xMin:s-l,zMin:n-l,xMax:c+l,zMax:m+l}})];case 1:return t.sent(),console.log("Triggered web worker mesh for ".concat(s,", ").concat(n,"!")),[2]}}))}))()}),[l,o,c,s,m,n]),(0,k.useEffect)((function(){o.addEventListener("message",function(){var t=(0,P.Z)((function(t){var a,e;return(0,v.__generator)(this,(function(r){return"loadMesh"!==t.data.type&&"erodeMesh"!==t.data.type&&"depositMesh"!==t.data.type||(a=t.data.args).xMin===s-l&&a.zMin===n-l&&a.xMax===c+l&&a.zMax===m+l&&(e=t.data.payload,console.log("Loading terrain mesh for x".concat(s,":").concat(c,", z").concat(n,":").concat(m,"...")),y(e.verts),M(e.vertsNum),j(e.vertsMetadata),z(e.vertsMetadataStride),S(e.vertsMetadataNum),C(e.cells),O(e.cellsNum),console.log("Loaded terrain mesh for x".concat(s,":").concat(c,", z").concat(n,":").concat(m,"!"))),[2]}))}));return function(a){return t.apply(this,arguments)}}())}),[l,o,c,s,m,n]),(0,r.jsx)(N,{verts:u,vertsNum:x,vertsMetadata:p,vertsMetadataStride:I,vertsMetadataNum:w,cells:T,cellsNum:L,sunPosition:h},"".concat(null!==(a=null===u||void 0===u?void 0:u.length)&&void 0!==a?a:0,"-").concat(null!==(e=null===p||void 0===p?void 0:p.length)&&void 0!==e?e:0,"-").concat(null!==(i=null===T||void 0===T?void 0:T.length)&&void 0!==i?i:0))},C=e(9817),Z=function(t){var a=t.nearestChunk,i=a.x,o=a.z,s=t.sunPosition,n=(0,k.useMemo)((function(){console.log(i,o);for(var t=[],a=0;a<=C.v.chunksToLoadAroundCamera;a++)for(var e=i-a;e<=i+a;e++)for(var r=o-a;r<=o+a;r++)e!=i-a&&r!=o-a&&e!=i+a&&r!=o+a||t.push({xMin:e*C.v.chunkSize,zMin:r*C.v.chunkSize,xMax:e*C.v.chunkSize+C.v.chunkSize,zMax:r*C.v.chunkSize+C.v.chunkSize});return t}),[i,o]),c=(0,k.useState)(new Worker(e.tu(new URL(e.p+e.u(381),e.b))))[0],m=(0,k.useState)(!1),l=m[0],h=m[1];return(0,k.useEffect)((function(){l||(c.addEventListener("message",function(){var t=(0,P.Z)((function(t){var a;return(0,v.__generator)(this,(function(e){return"init"===t.data.type&&((a=t.data.payload)?(console.log("Terrain worker initialized!"),h(!0)):console.warn("Error web worker init response:",a)),[2]}))}));return function(a){return t.apply(this,arguments)}}()),(0,P.Z)((function(){return(0,v.__generator)(this,(function(t){switch(t.label){case 0:return console.log("Triggering web worker init..."),[4,c.postMessage({type:"init",payload:{seed:C.v.testSeed}})];case 1:return t.sent(),console.log("Triggered web worker init!"),[2]}}))}))())}),[c,l]),(0,k.useEffect)((function(){return function(){console.log("Terminating terrain web worker..."),h(!1),c.terminate()}}),[c]),(0,k.useEffect)((function(){(0,P.Z)((function(){var t;return(0,v.__generator)(this,(function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<20?[4,new Promise((function(t){return setTimeout(t,200)}))]:[3,4];case 2:a.sent(),c.postMessage({type:"depositMesh",payload:{chunk:{xMin:0-C.v.chunkPadding,zMin:0-C.v.chunkPadding,xMax:C.v.chunkSize+C.v.chunkPadding,zMax:C.v.chunkSize+C.v.chunkPadding},x:16,y:0+t,z:16}}),c.postMessage({type:"erodeMesh",payload:{chunk:{xMin:0-C.v.chunkPadding,zMin:0-C.v.chunkPadding,xMax:C.v.chunkSize+C.v.chunkPadding,zMax:C.v.chunkSize+C.v.chunkPadding},x:20,y:16-t,z:20}}),a.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))()}),[c]),(0,r.jsx)(r.Fragment,{children:l&&n.map((function(t){var a=t.xMin,e=t.zMin,i=t.xMax,o=t.zMax;return(0,r.jsx)(T,{terrainWorker:c,xMin:a,zMin:e,xMax:i,zMax:o,padding:C.v.chunkPadding,sunPosition:s},"".concat(a,"-").concat(i,"-").concat(e,"-").concat(o))}))})},L=function(){var t=(0,n.j)(i.ET),a=(0,k.useRef)(),e=function(t){var a=(0,k.useState)({x:0,z:0}),e=a[0],r=a[1];return(0,k.useEffect)((function(){var a=function(){var a=(0,P.Z)((function(){var a,e,i,o;return(0,v.__generator)(this,(function(s){switch(s.label){case 0:a={x:0,z:0},s.label=1;case 1:return t.current&&(e=t.current.target,i=Math.floor(e.x/C.v.chunkSize),o=Math.floor(e.z/C.v.chunkSize),i===a.x&&o===a.z||(a={x:i,z:o},r({x:i,z:o}))),[4,new Promise((function(t){return setTimeout(t,C.v.chunkCheckRateMs)}))];case 2:return s.sent(),[3,1];case 3:return[2]}}))}));return function(){return a.apply(this,arguments)}}();a()}),[t]),e}(a),m=(0,k.useState)((function(){return new o.Vector3(.5,1,0)}))[0];return(0,r.jsx)(s.Xz,{children:(0,r.jsxs)(t,{children:[(0,r.jsx)(c.q,{sunPosition:m}),(0,r.jsx)("directionalLight",{position:m}),(0,r.jsx)("ambientLight",{intensity:.75}),(0,r.jsx)(h,{mapControls:a}),(0,r.jsx)(p,{position:[0,10,0]}),(0,r.jsx)(Z,{nearestChunk:e,sunPosition:m}),(0,r.jsx)(y,{})]})})};function O(){return(0,r.jsx)(L,{})}}},function(t){t.O(0,[546,522,774,888,179],(function(){return a=7314,t(t.s=a);var a}));var a=t.O();_N_E=a}]);